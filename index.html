<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Página de Sorteio</title>
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
  <main class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-8">
    <header class="mb-6">
      <h1 class="text-2xl font-bold text-center">Sorteador</h1>
      <p class="text-sm text-center text-gray-500">Informe o nome do sorteio e o intervalo de números. Clique em sortear!</p>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="col-span-1 md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do sorteio</label>
        <input id="raffleName" type="text" placeholder="Ex: Sorteio do Mês" class="w-full rounded-lg border-gray-200 shadow-sm p-3 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Número mínimo</label>
        <input id="minNumber" type="number" value="1" class="w-full rounded-lg border-gray-200 shadow-sm p-3 focus:outline-none" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Número máximo</label>
        <input id="maxNumber" type="number" value="100" class="w-full rounded-lg border-gray-200 shadow-sm p-3 focus:outline-none" />
      </div>

      <div class="md:col-span-2 flex items-center gap-3">
        <button id="drawBtn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg shadow">Sortear</button>
        <button id="resetHistory" class="bg-red-50 text-red-600 border border-red-100 py-2 px-4 rounded-lg">Limpar histórico</button>
        <button id="copyResult" class="bg-gray-50 text-gray-700 border border-gray-200 py-2 px-4 rounded-lg">Copiar</button>
      </div>
    </section>

    <section class="mb-6">
      <div class="rounded-xl bg-gradient-to-r from-indigo-50 to-white p-6 text-center">
        <div class="text-sm text-gray-500">Resultado do sorteio</div>
        <div id="result" class="mt-4 text-4xl font-extrabold text-indigo-600">—</div>
        <div id="resultRaffleName" class="mt-2 text-sm text-gray-600"></div>
      </div>
    </section>

    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Histórico de vencedores</h2>
        <small class="text-xs text-gray-500" id="historyCount">0 sorteios</small>
      </div>
      <ul id="history" class="space-y-2 max-h-40 overflow-auto">
        <!-- itens do histórico aparecerão aqui -->
      </ul>
    </section>

    <footer class="mt-6 text-xs text-gray-500 text-center">Feito com ♥ — teste localmente abrindo este arquivo no navegador.</footer>
  </main>

  <script>
    // Helpers
    const el = id => document.getElementById(id);
    const raffleName = el('raffleName');
    const minNumber = el('minNumber');
    const maxNumber = el('maxNumber');
    const drawBtn = el('drawBtn');
    const result = el('result');
    const resultRaffleName = el('resultRaffleName');
    const historyList = el('history');
    const historyCount = el('historyCount');
    const resetHistory = el('resetHistory');
    const copyResult = el('copyResult');

    let winners = [];

    function validateInputs() {
      const min = Number(minNumber.value);
      const max = Number(maxNumber.value);
      if (!Number.isFinite(min) || !Number.isFinite(max)) return { ok: false, msg: 'Mínimo e máximo devem ser números.' };
      if (!Number.isInteger(min) || !Number.isInteger(max)) return { ok: false, msg: 'Use números inteiros.' };
      if (min > max) return { ok: false, msg: 'Número mínimo não pode ser maior que o máximo.' };
      return { ok: true, min, max };
    }

    function getRandomIntInclusive(min, max) {
      // garantia de inteiros
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function renderHistory() {
      historyList.innerHTML = '';
      winners.slice().reverse().forEach((w, i) => {
        const li = document.createElement('li');
        li.className = 'p-3 rounded-lg bg-gray-50 border border-gray-100 flex items-center justify-between';
        li.innerHTML = `<div><div class="text-sm font-medium">${escapeHtml(w.raffle || 'Sorteio')}</div><div class="text-xs text-gray-500">${w.date}</div></div><div class="text-lg font-semibold text-indigo-600">${w.number}</div>`;
        historyList.appendChild(li);
      });
      historyCount.textContent = `${winners.length} sorteio(s)`;
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    drawBtn.addEventListener('click', () => {
      const v = validateInputs();
      if (!v.ok) {
        alert(v.msg);
        return;
      }
      const num = getRandomIntInclusive(v.min, v.max);
      const now = new Date();
      const item = {
        raffle: raffleName.value.trim() || 'Sorteio',
        number: num,
        date: now.toLocaleString()
      };
      winners.push(item);

      // animação simples
      result.textContent = '...';
      result.classList.remove('opacity-0');
      setTimeout(() => {
        result.textContent = item.number;
        resultRaffleName.textContent = item.raffle;
        renderHistory();
      }, 300);
    });

    resetHistory.addEventListener('click', () => {
      if (!confirm('Limpar todo o histórico?')) return;
      winners = [];
      renderHistory();
      result.textContent = '—';
      resultRaffleName.textContent = '';
    });

    copyResult.addEventListener('click', async () => {
      const txt = result.textContent === '—' ? 'Nenhum resultado' : `${resultRaffleName.textContent || 'Sorteio'}: ${result.textContent}`;
      try {
        await navigator.clipboard.writeText(txt);
        copyResult.textContent = 'Copiado!';
        setTimeout(() => copyResult.textContent = 'Copiar', 1500);
      } catch (e) {
        alert('Não foi possível copiar automaticamente. Selecione o número e copie manualmente.');
      }
    });

    // pequenas melhorias de UX: impedir min > max enquanto digita
    minNumber.addEventListener('input', () => {
      const v = validateInputs();
      drawBtn.disabled = !v.ok;
      drawBtn.classList.toggle('opacity-50', !v.ok);
    });
    maxNumber.addEventListener('input', () => {
      const v = validateInputs();
      drawBtn.disabled = !v.ok;
      drawBtn.classList.toggle('opacity-50', !v.ok);
    });

    // inicial
    (function init() {
      renderHistory();
      drawBtn.disabled = false;
    })();
  </script>
</body>
</html>
